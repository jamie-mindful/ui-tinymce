angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(e,t,n,i,r,o,u){return(o=o||{}).baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(c,a,s,d){function m(e){e?(f(),$&&$.getBody().setAttribute("contenteditable",!1)):(f(),$&&!$.settings.readonly&&$.getDoc()&&$.getBody().setAttribute("contenteditable",!0))}function f(){$||($=tinymce.get(s.id))}if(i.tinymce){var l,$,v=d[0],g=d[1]||null,y={debounce:!0},b=function(t){var n=t.getContent({format:y.format}).trim();n=r.trustAsHtml(n),v.$setViewValue(n),e.$$phase||c.$digest()},p=u.getUniqueId();s.$set("id",p),l={},angular.extend(l,c.$eval(s.uiTinymce));var h=function(e){var t;return function(e){n.cancel(t),t=n(function(){return function(e){e.getContent({format:y.format}).trim()!=v.$viewValue&&e.isDirty()&&(e.save(),b(e))}(e)},400)}}(),U={setup:function(t){t.on("init",function(){v.$render(),v.$setPristine(),v.$setUntouched(),g&&g.$setPristine()}),t.on("ExecCommand change NodeChange ObjectResized",function(){if(!y.debounce)return t.save(),void b(t);h(t)}),t.on("blur",function(){a[0].blur(),v.$setTouched(),e.$$phase||c.$digest()}),t.on("remove",function(){a.remove()}),o.setup&&o.setup(t,{updateView:b}),l.setup&&l.setup(t,{updateView:b})},format:l.format||"html",selector:"#"+s.id};angular.extend(y,o,l,U),n(function(){y.baseURL&&(tinymce.baseURL=y.baseURL);var e=tinymce.init(y);e&&"function"==typeof e.then?e.then(function(){m(c.$eval(s.ngDisabled))}):m(c.$eval(s.ngDisabled))}),v.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""}),v.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""}),v.$render=function(){f();var e=v.$viewValue?r.getTrustedHtml(v.$viewValue):"";$&&$.getDoc()&&($.setContent(e),$.fire("change"))},s.$observe("disabled",m),c.$on("$tinymce:refresh",function(e,n){var i=s.id;if(angular.isUndefined(n)||n===i){var r=a.parent(),o=a.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),r.append(t(o)(c))}}),c.$on("$destroy",function(){f(),$&&($.remove(),$=null)})}}}}]).service("uiTinymceService",[function(){return new function(){var e=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++e}}}}]);
